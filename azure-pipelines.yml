trigger:
- main

pool: atris-dev-local

variables:
  buildConfiguration: 'Release'

jobs: 
- job: 'dotnet_build_and_test'
  steps:
  - script: dotnet build ./src
    displayName: 'dotnet build'
  - script: dotnet test ./src
    displayName: 'dotnet test'
- job: 'docker_build_and_test' 
  steps:
  - task: Docker@2
    inputs:
      command: 'build'
      Dockerfile: './src/Books.Service.Web/Dockerfile'
      buildContext: '.'
  - task: DockerCompose@0
    displayName: 'docker compose create database'
    inputs:
      action: 'Run services'
      dockerComposeFile: '**/docker-compose-db-only.yaml'
      buildImages: true
      detached: true